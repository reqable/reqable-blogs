---
title: å¦‚ä½•å¯¹Flutteråº”ç”¨æŠ“åŒ…è°ƒè¯•
authors: reqable
tags: [Reqableæ•™ç¨‹]
hide_table_of_contents: false
---

Flutteråº”ç”¨ç½‘ç»œè¯·æ±‚è°ƒè¯•ä¸€ç›´æ˜¯ä¸šå†…éš¾é¢˜ï¼ŒåŸå› åœ¨äºDartè¯­è¨€æ ‡å‡†åº“çš„ç½‘ç»œè¯·æ±‚ä¸ä¼šèµ°Wi-Fiä»£ç†ï¼Œå¸¸è§„é€šè¿‡é…ç½®Wi-Fiä»£ç†æ¥æŠ“åŒ…çš„æ–¹å¼è¡Œä¸é€šã€‚è¿™ç»™æˆ‘ä»¬æ—¥å¸¸å¼€å‘æµ‹è¯•é€ æˆäº†å¾ˆå¤§çš„é˜»ç¢ï¼Œä¸¥é‡é™ä½å·¥ä½œæ•ˆç‡ã€‚å› æ­¤å†™ä¸€ç¯‡æ•™ç¨‹ï¼Œè®²è§£å¦‚ä½•ä½¿ç”¨Reqableå¯¹Flutterç§»åŠ¨åº”ç”¨è¿›è¡ŒæŠ“åŒ…è°ƒè¯•ã€‚

<!--truncate-->

# 1. ç¯å¢ƒå‡†å¤‡
- ç”µè„‘ï¼šWindows/Mac/Linuxæœºå™¨ï¼Œå®‰è£…Reqableå®¢æˆ·ç«¯ï¼ˆå»ºè®®2.18.0ä»¥ä¸Šç‰ˆæœ¬ï¼‰ã€‚
- æ‰‹æœºï¼šAndroid/iOSè®¾å¤‡ï¼Œå®‰è£…Reqableç§»åŠ¨ç«¯Appï¼ˆè¦æ±‚æœ€ä½2.19.0ç‰ˆæœ¬ï¼‰ã€‚

# 2. å®‰è£…è¯ä¹¦

é¦–å…ˆï¼Œå¯åŠ¨Reqableç”µè„‘å®¢æˆ·ç«¯ï¼Œå®Œæˆåˆå§‹åŒ–è¿›å…¥ä¸»ç•Œé¢ã€‚ç‚¹å‡»é¡¶éƒ¨æ‰‹æœºå›¾æ ‡ï¼Œæ‰“å¼€äºŒç»´ç ã€‚

![ç”µè„‘äºŒç»´ç ](screenshot_01.png)

æ¥ä¸‹æ¥ï¼Œæ‰‹æœºè¿æ¥åˆ°å’Œç”µè„‘æ‰€åœ¨çš„åŒä¸€ä¸ªWi-Fiå±€åŸŸç½‘ã€‚æ‰“å¼€Reqableæ‰‹æœºAppï¼Œé€‰æ‹©ååŒæ¨¡å¼ï¼Œæ‰«æä¸Šé¢ç”µè„‘ç«¯äºŒç»´ç è¿›è¡Œè¿æ¥ã€‚

![ååŒæ¨¡å¼](screenshot_02.png)

è¿æ¥æˆåŠŸåï¼Œå¼€å§‹ä¸‹ä¸€æ­¥ï¼Œå®‰è£…è¯ä¹¦ã€‚ç”±äºæ˜¯å¯¹æ‰‹æœºæŠ“åŒ…ï¼Œéœ€è¦åœ¨æ‰‹æœºå®‰è£…è¯ä¹¦ï¼Œè€Œä¸æ˜¯åœ¨ç”µè„‘å®‰è£…è¯ä¹¦ï¼Œæ‰€ä»¥ç”µè„‘ä¸Šçš„è¯ä¹¦å¯ä»¥é€‰æ‹©ä¸å®‰è£…ã€‚

Reqableåœ¨ä¸Šé¢é€‰æ‹©ååŒæ¨¡å¼åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå·²ç»è‡ªåŠ¨å°†ç”µè„‘çš„æ ¹è¯ä¹¦åŒæ­¥åˆ°äº†æ‰‹æœºï¼Œå®‰è£…è¯ä¹¦åªéœ€è¦åœ¨æ‰‹æœºä¸Šæ“ä½œå³å¯ï¼Œæ— éœ€å°†è¯ä¹¦æ‰‹åŠ¨ä»ç”µè„‘æ‹·è´ä¼ è¾“åˆ°æ‰‹æœºã€‚**æ³¨æ„ï¼šæ‰‹æœºæŠ“åŒ…ï¼Œå¿…é¡»å®‰è£…ç”µè„‘è¯ä¹¦åˆ°æ‰‹æœºã€‚å¦‚æœAppæ˜¯ä»¥ç‹¬ç«‹æ¨¡å¼åˆå§‹åŒ–ï¼ŒAppä¼šç”Ÿæˆå’Œç”µè„‘ä¸åŒçš„æ ¹è¯ä¹¦ï¼Œæ‰«ç è¿æ¥ç”µè„‘åéœ€è¦æ‰‹åŠ¨åŒæ­¥æ ¹è¯ä¹¦åˆ°æ‰‹æœºå†å®‰è£…ã€‚**

### Androidè®¾å¤‡

æ³¨æ„ï¼ŒFlutteråº”ç”¨ç¨‹åºåªä¿¡ä»»Androidç³»ç»Ÿç›®å½•çš„è¯ä¹¦ï¼Œä¸ä¼šä¿¡ä»»ç”¨æˆ·è¯ä¹¦ã€‚Nativeåº”ç”¨æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½® network_security_config.xml æ–‡ä»¶æˆ–è€…é™ä½targetSdkVersionåˆ°23æ¥è®©åº”ç”¨ä¿¡ä»»ç”¨æˆ·è¯ä¹¦ï¼Œä½†æ˜¯è¿™ä¸ªå¯¹äºFlutteråº”ç”¨æ˜¯ä¸è¡Œçš„ã€‚

å› ä¸ºDart SDKä¸­å·²ç»å¼ºè¡Œå†™æ­»äº†åªä¿¡ä»»ç³»ç»Ÿç›®å½•ä¸‹çš„è¯ä¹¦ã€‚è¿™ä¸ªé€»è¾‘å®šä¹‰åœ¨Â runtime/bin/security_context_linux.cc ä¸­ï¼Œæœ‰å…´è¶£å¯ä»¥å»ç¿»çœ‹æºç ã€‚

```c++
// On Android, we don't compile in the trusted root certiicates. Instead,
// we use the directory of trusted certificates already present on the
// device. This saves ~240KB from the size of the binary. This has the
// drawback that SSL_do_handshake will synchronously hit the filesystem
// looking for root certs during its trust evaluation. We call
// SSL_do_handshake directly from the Dart thread so that Dart code can be
// invoked from the "bad certificate" callback called by SSL_do_handshake.
const char* android_cacerts = "/system/etc/security/cacerts";
LoadRootCertCache(android_cacerts);
```

Androidè®¾å¤‡ä¸Šè¦å®‰è£…è¯ä¹¦åˆ°ç³»ç»Ÿç›®å½•ï¼Œç›®å‰åªæœ‰ä¸¤ç§æ–¹å¼ï¼š

æ–¹å¼ä¸€ï¼šRootè®¾å¤‡ï¼ŒUSBè¿æ¥åˆ°ç”µè„‘ï¼ŒReqableå¯ä»¥é€šè¿‡ADBä¸€é”®å®‰è£…ã€‚

![ä¸€é”®å®‰è£…](screenshot_03.png)

æ–¹å¼äºŒï¼šè®¾å¤‡åˆ·Magiskç¯å¢ƒï¼Œä»Reqableä¸‹è½½è¯ä¹¦æ¨¡å—ï¼Œå®‰è£…å³å¯ã€‚

Magiskæ¨¡å—æ—¢å¯ä»¥ä»ç”µè„‘ç«¯ä¸‹è½½ï¼ˆè§ä¸Šå›¾Magiskï¼‰ï¼Œä¹Ÿå¯ä»¥ä»æ‰‹æœºç«¯`è¯ä¹¦ç®¡ç†` -> `å®‰è£…æ ¹è¯ä¹¦åˆ°æœ¬æœº` -> `Magiskæ¨¡å—`ä¿å­˜ã€‚

æ ¹è¯ä¹¦å®‰è£…æˆåŠŸåï¼ŒReqableæ‰‹æœºAppä¼šæœ‰è¯ä¹¦å·²å®‰è£…çš„æç¤ºã€‚å¦‚æœå·²ç»å®‰è£…ï¼Œä½†ä»ç„¶æç¤ºè¯ä¹¦æœªå®‰è£…ï¼Œå¯èƒ½æ˜¯æ“ä½œå‡ºé”™ï¼Œè¯·å¤æŸ¥å®‰è£…æ­¥éª¤ã€‚

### iOSè®¾å¤‡

iOSå®‰è£…è¯ä¹¦è¦ç®€å•å¾ˆå¤šï¼Œæ ‡å‡†ä¸‰ä¸ªæ­¥éª¤ã€‚

- ä¸‹è½½æè¿°æ–‡ä»¶ã€‚å¯ä»¥ä»Reqableæ‰‹æœºAppç›´æ¥ä¿å­˜ï¼Œä¹Ÿå¯ä»¥å¯åŠ¨æµè§ˆå™¨ä¸‹è½½æè¿°æ–‡ä»¶ã€‚
- è®¾ç½® -> ä¸‹è½½çš„æè¿°æ–‡ä»¶ -> é€‰æ‹©æ–‡ä»¶ -> å®‰è£…ã€‚
- è®¾ç½® -> é€šç”¨ -> å…³äº -> è¯ä¹¦ä¿¡ä»»è®¾ç½® -> æ‰“å¼€å¼€å…³ã€‚

![å®‰è£…è¯ä¹¦](screenshot_04.png)

å¯ä»¥çœ‹åˆ°iOSè®¾å¤‡å®‰è£…è¯ä¹¦è¦ç®€å•å¾ˆå¤šï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬æ¨èä½¿ç”¨iOSè®¾å¤‡è°ƒè¯•ã€‚

æ›´å¤šæœ‰å…³è¯ä¹¦å®‰è£…çš„è¯´æ˜ï¼Œå¯ä»¥æŸ¥é˜…Reqable[å®˜ç½‘æ–‡æ¡£](https://reqable.com/zh-CN/docs/getting-started/installation/)ã€‚

# 3. å¢å¼ºæ¨¡å¼

åœ¨æ‰‹æœºAppä¸Šï¼ŒReqableæä¾›äº†ä¸¤ç§ç½‘ç»œæµé‡æ•è·æ¨¡å¼ï¼Œä¸€ç§æ˜¯**å¸¸è§„æ¨¡å¼**ï¼Œä¸€ç§æ˜¯**å¢å¼ºæ¨¡å¼**ã€‚è¿™é‡Œå…ˆç®€å•ä»‹ç»ä¸‹ä¸¤ç§æ¨¡å¼çš„åŒºåˆ«ã€‚

å¸¸è§„æ¨¡å¼ï¼Œå’Œé…ç½®Wi-Fiä»£ç†æ•ˆæœä¸€æ ·ï¼Œä½†æ˜¯ä¸éœ€è¦ç”¨æˆ·å»æ‰‹åŠ¨é…ç½®Wi-Fiä»£ç†ã€‚å¯ä»¥å¯¹ç»å¤§å¤šæ•°åº”ç”¨çš„æµé‡åˆ†æï¼ŒåŒ…æ‹¬æµè§ˆå™¨ç­‰ã€‚

å¢å¼ºæ¨¡å¼ï¼Œå¼ºåˆ¶æ•è·æ‰€æœ‰çš„æµé‡ï¼ŒåŒ…æ‹¬ä¸èµ°Wi-Fiä»£ç†çš„ç½‘ç»œè¯·æ±‚æµé‡ï¼Œä¾‹å¦‚æˆ‘ä»¬éœ€è¦è§£å†³çš„Flutteråº”ç”¨ã€‚åœ¨Androidè®¾å¤‡ä¸Šï¼Œå¢å¼ºæ¨¡å¼è¿˜å¯ä»¥è·å–åˆ°æµé‡æ¥æºçš„åº”ç”¨ä¿¡æ¯ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼ŒAndroidæ˜¯è‡ªåŠ¨å¼€å¯å¢å¼ºæ¨¡å¼çš„ï¼Œç”¨æˆ·æ— éœ€æ‰‹åŠ¨å¼€å¯ã€‚iOSè®¾å¤‡æœ‰äº›ç‰¹æ®Šï¼Œæ‰‹æœºåœ¨éååŒæ¨¡å¼ä¸‹æ— æ³•å¼€å¯å¢å¼ºæ¨¡å¼ï¼Œå¿…é¡»è¿æ¥ååŒè®¾å¤‡ï¼ˆç”µè„‘ï¼‰ï¼Œå¹¶åœ¨æ ‡é¢˜èœå•ä¸­æ‰‹åŠ¨å¼€å¯ã€‚

![å¢å¼ºæ¨¡å¼](screenshot_05.png)

å¯¹äºFlutteråº”ç”¨ï¼Œè¯·ä¸€å®šè¦å¼€å¯å¢å¼ºæ¨¡å¼ã€‚å¢å¼ºæ¨¡å¼å¼€å¯åï¼Œæ ‡é¢˜åé¢ä¼šå‡ºç°ä¸€ä¸ªé’¥åŒ™ğŸ”‘æ ‡è®°ã€‚

# 4. å®æˆ˜æ¼”ç¤º

é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªFlutterç©ºé¡¹ç›®ï¼Œè¿™ä¸ªé¡¹ç›®æˆ‘ä»¬ç®€å•æ”¹æ”¹ä»£ç ä½œä¸ºæµ‹è¯•åº”ç”¨ã€‚

```
flutter create capture_test
```

åŠ ç‚¹ä»£ç ï¼Œæ¯”å¦‚ç‚¹å‡»Â  **+** æŒ‰é’®ï¼Œå‘é€ä¸€æ¬¡HTTPè¯·æ±‚ã€‚
```dart
void _incrementCounter() async {
  final HttpClient httpClient = HttpClient();
  final HttpClientRequest request = await httpClient.getUrl(Uri.parse('https://httpbin.org/get'));
  request.close();
}
```
é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼Œå¯åŠ¨Flutteråº”ç”¨ã€‚
```
flutter run -d è®¾å¤‡ID
```
æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¼€å§‹æµ‹è¯•ã€‚Reqableæ‰‹æœºAppä¸­å¼€å¯è°ƒè¯•ï¼Œç”µè„‘ç«¯åŒæ—¶ä¼šè¿›å…¥è°ƒè¯•çŠ¶æ€ï¼Œå¦‚æœç”µè„‘æ²¡æœ‰è‡ªåŠ¨å¼€å¯è°ƒè¯•ï¼Œé‚£ä¹ˆæ‰‹åŠ¨å¯åŠ¨ä¸€ä¸‹ã€‚

æ­£å¸¸æƒ…å†µä¸‹ï¼Œåº”è¯¥èƒ½æˆåŠŸæŠ“åˆ°HTTPè¯·æ±‚äº†ï¼Œå¦‚ä¸‹å›¾ã€‚

![æ•è·æµé‡](screenshot_06.png)

å¦‚æœå‡ºç°ä¸‹å›¾è¿™ç§**å®¢æˆ·ç«¯SSLæ¡æ‰‹å¤±è´¥**çš„æç¤ºï¼Œè¯´æ˜æ˜¯æ‰‹æœºä¸Šè¯ä¹¦æ²¡æœ‰å®‰è£…æˆåŠŸã€‚

![SSLé”™è¯¯](screenshot_07.png)

è¿™ç§æƒ…å†µï¼Œåœ¨å‘½ä»¤è¡Œæ§åˆ¶å°ä¸­ä¹Ÿèƒ½çœ‹åˆ°Flutterçš„æŠ¥é”™ã€‚

```
E/flutter (24436): [ERROR:flutter/runtime/dart_vm_initializer.cc(41)] Unhandled Exception: HandshakeException: Handshake error in client (OS Error:
E/flutter (24436):   CERTIFICATE_VERIFY_FAILED: unable to get local issuer certificate(handshake.cc:393))
E/flutter (24436): #0      _SecureFilterImpl._handshake (dart:io-patch/secure_socket_patch.dart:99:46)
E/flutter (24436): #1      _SecureFilterImpl.handshake (dart:io-patch/secure_socket_patch.dart:143:25)
E/flutter (24436): #2      _RawSecureSocket._secureHandshake (dart:io/secure_socket.dart:920:54)
E/flutter (24436): #3      _RawSecureSocket._tryFilter (dart:io/secure_socket.dart:1049:19)
E/flutter (24436): <asynchronous suspension>
```
**Qï¼šåªæœ‰Androidè®¾å¤‡ï¼Œä¸”æ— æ³•å°†è¯ä¹¦å®‰è£…åˆ°ç³»ç»Ÿè¯ä¹¦ç›®å½•ï¼Œé‚£ä¹ˆè¯¥æ€ä¹ˆåŠï¼Ÿ**

ä¿®æ”¹ä»£ç å¼ºè¡Œä¿¡ä»»ä»»æ„è¯ä¹¦ï¼Œé€šè¿‡è¿™ä¸ªè¿˜å¯ä»¥è·³è¿‡å‰é¢è¯ä¹¦å®‰è£…é‚£ä¸€æ­¥ï¼ŒçœŸæ­£çš„æ— é—¨æ§›ï¼Œä½†å°±æ˜¯ä¸å®‰å…¨ã€‚æ‰€ä»¥è¯·æ³¨æ„ï¼š***åº”ç”¨æ­£å¼å‘è¡Œç‰ˆæœ¬åŠ¡å¿…åˆ é™¤æˆ–è€…ç»•è¿‡æ­¤é¡¹è®¾ç½®***ã€‚
```dart
httpClient.badCertificateCallback = (X509Certificate cert, String host, int port) => true;
```
**Qï¼šåªæƒ³ç”¨ç”µè„‘ï¼Œä¸æƒ³ç”¨Reqableæ‰‹æœºAppååŒï¼Œæ€ä¹ˆåŠï¼Ÿ**

åŒæ ·è¦ä¿®æ”¹ä»£ç ï¼Œé…ç½®ç½‘ç»œè¯·æ±‚å¿…é¡»èµ°ä»£ç†ï¼š
```dart
httpClient.findProxy = (url) {
  return 'PROXY ç”µè„‘IP:ç”µè„‘æŠ“åŒ…ç«¯å£';
};
```

å¥½äº†ï¼Œæœ¬ç¯‡æ•™ç¨‹åˆ°è¿™é‡ŒåŸºæœ¬å°±ç»“æŸäº†ã€‚